<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestión Académica</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-light">

  <!-- Header -->
  <header class="d-flex justify-content-between align-items-center p-3" style="background:#2a73ff; color:white;">
    <h1 class="m-0">
      <a href="#" id="homeLink" class="tituloNav" style="color:white; text-decoration:none;">Gestor Académico</a>
    </h1>
    <div class="d-flex align-items-center gap-2">
      <span id="userInfo" class="badge rounded-pill bg-light text-dark" style="display:none;"></span>
      <button id="logoutBtn" class="btn btn-light btn-sm" style="display:none;">Salir</button>
    </div>
  </header>

  <!-- Nav -->
  <nav id="mainNav">
    <ul class="menu">
      <li><a href="/perfil.html">Perfil</a></li>
      <li><a href="gestion-academica.html" class="selectedNav">Gestión Académica</a></li>
      <li><a href="/menu-tareas.html">Tareas y Colaboración</a></li>
      <li><a href="#">Estadísticas</a></li>
      <li><a href="#">Logs</a></li>
      <li class="role-only" data-roles="administrador" style="display:none;"><a href="/admin-usuarios.html">Gestión de Usuarios</a>
    </ul>
  </nav>

  <!-- Main -->
  <main>
    <div class="container py-5">
      <h2 class="text-center mb-4 text-primary">Gestión Académica</h2>

      <div class="row g-4">
        <!-- Listado de Cursos (todos) -->
        <div class="col-sm-6 col-md-4 card-role" data-roles="estudiante,profesor,administrador">
          <a href="/cursos.html" class="text-decoration-none text-dark">
            <div class="card bento-card shadow-sm h-100">
              <div class="card-body text-center">
                <div class="bento-icon">📚</div>
                <h5 class="card-title mt-2">Listado de Cursos</h5>
                <p class="card-text small">Explora los cursos disponibles y sus detalles.</p>
              </div>
            </div>
          </a>
        </div>

        <!-- Crear Proyecto (profesor, admin) -->
        <div class="col-sm-6 col-md-4 card-role" data-roles="profesor,administrador">
          <a href="/crear-proyecto.html" class="text-decoration-none text-dark">
            <div class="card bento-card shadow-sm h-100">
              <div class="card-body text-center">
                <div class="bento-icon">🧩</div>
                <h5 class="card-title mt-2">Crear Proyecto</h5>
                <p class="card-text small">Crea proyectos colaborativos asociados a un curso.</p>
              </div>
            </div>
          </a>
        </div>

        <!-- Gestionar Equipo (profesor, admin) -->
        <div class="col-sm-6 col-md-4 card-role" data-roles="profesor,administrador">
          <a href="/gestionar-equipo.html" class="text-decoration-none text-dark">
            <div class="card bento-card shadow-sm h-100">
              <div class="card-body text-center">
                <div class="bento-icon">👥</div>
                <h5 class="card-title mt-2">Gestionar Equipo</h5>
                <p class="card-text small">Forma equipos, asigna roles y administra miembros.</p>
              </div>
            </div>
          </a>
        </div>
      </div>

    </div>
  </main>

  <!-- Logic -->
  <script>
    function cap(s){ return s ? s.charAt(0).toUpperCase()+s.slice(1) : ''; }

    async function loadMe(){
      const res = await fetch('/api/auth/me');
      if(!res.ok){ window.location.href = '/login.html'; return null; }
      return res.json();
    }

    (async () => {
      try {
        const data = await loadMe();
        if(!data) return;
        const user = data.user || {};
        const rol  = user.rolNombre || 'estudiante';

        // home por rol
        const home =
          rol === 'profesor' ? '/index-profesor.html' :
          rol === 'administrador' ? '/index-admin.html' :
          '/index-estudiante.html';

        const homeLink = document.getElementById('homeLink');
        if(homeLink) homeLink.href = home;

        // header info + logout
        const info = document.getElementById('userInfo');
        if(info){
          info.textContent = `${user.nombre} · ${cap(rol)}`;
          info.style.display = 'inline-flex';
        }
        const logoutBtn = document.getElementById('logoutBtn');
        if(logoutBtn){
          logoutBtn.style.display = 'inline-block';
          logoutBtn.addEventListener('click', async ()=>{
            await fetch('/api/auth/logout', { method:'POST' });
            window.location.href = '/login.html';
          });
        }

        // filtrar tarjetas por rol
        document.querySelectorAll('.card-role').forEach(card=>{
          const roles = (card.getAttribute('data-roles')||'')
                        .split(',').map(r=>r.trim());
          if(!roles.includes(rol)) card.style.display = 'none';
        });
      } catch (e) {
        console.error(e);
        window.location.href = '/login.html';
      }
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/auth-ui.js"></script>
  <script>
    AuthUI.initHeader({ protect:true });
  </script>
</body>
</html>
